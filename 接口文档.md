#### 1. 接口说明
接口功能：  
上传一张图片，识别图中人物是否为系统已知人脸。

接口请求地址：
```
POST /upload_photo
```

---

#### 2. 请求头：

| 请求头         | 请求内容           | 说明         |
|----------------|--------------------|--------------|
| Content-Type   | multipart/form-data | 上传文件格式 |

---

#### 3. 请求示例：

使用表单上传图片：
```
form-data:
  file: test_face.jpg
```

---

#### 4. 请求参数说明：

| 字段名 | 字段说明     | 字段类型 | 是否必填 |
|--------|--------------|----------|----------|
| file   | 待识别人脸图片 | file     | 是       |

---

#### 5. 响应示例

成功响应：
```json
{
  "faces_detected": 1,
  "results": [
    {
      "name": "JohnDoe",
      "location": [120, 200, 80, 160]
    }
  ]
}
```

失败响应：
```json
{
  "error": "No file uploaded"
}
```

---

#### 6. 响应参数说明

| 接口返回码 | 接口返回描述       |
|------------|--------------------|
| 200        | 成功               |
| 400        | 参数缺失，如未上传文件 |
| 500        | 系统异常           |

#### 1. 接口说明
接口功能：  
通过对接 DeepSeek 模型，与用户进行智能问答，自动结合本地设备状态数据生成回答。

接口请求地址：
```
POST /chat
```

---

#### 2. 请求头：

| 请求头         | 请求内容        | 说明         |
|----------------|-----------------|--------------|
| Content-Type   | application/json | 请求格式     |

---

#### 3. 请求示例：

```json
{
  "message": "现在室内温度多少？"
}
```

---

#### 4. 请求参数说明：

| 字段名  | 字段说明       | 字段类型 | 是否必填 |
|---------|----------------|----------|----------|
| message | 用户输入的问题 | string   | 是       |

---

#### 5. 响应示例

成功响应：
```json
{
  "reply": "当前室内温度为23.5°C，空气湿度为48%。",
  "usage": {
    "prompt_tokens": 112,
    "completion_tokens": 23,
    "total_tokens": 135
  }
}
```

失败响应：
```json
{
  "error": "Missing message"
}
```

---

#### 6. 响应参数说明

| 接口返回码 | 接口返回描述     |
|------------|------------------|
| 200        | 请求成功         |
| 400        | 缺少 message 字段 |
| 500        | 第三方模型请求失败或系统异常 |

#### 1. 接口说明
接口功能：  
接收来自智能设备的传感器数据与状态信息，系统缓存并自动合并后入库。

接口请求地址：
```
POST /iot-data
```

---

#### 2. 请求头：

| 请求头       | 请求内容        | 说明         |
|--------------|-----------------|--------------|
| Content-Type | application/json | JSON 格式提交 |

---

#### 3. 请求示例：

```json
{
  "notify_data": {
    "header": {
      "device_id": "dev_001"
    },
    "body": {
      "services": [
        {
          "properties": {
            "temperature_indoor": 22.6,
            "humidity_indoor": 45,
            "door_state": "open"
          }
        }
      ]
    }
  }
}
```

---

#### 4. 请求参数说明：

| 字段名           | 字段说明           | 字段类型 | 是否必填 |
|------------------|--------------------|----------|----------|
| device_id        | 设备唯一标识       | string   | 是       |
| services         | 属性服务对象数组   | array    | 是       |
| properties       | 设备状态与传感值字段 | object   | 是       |

---

#### 5. 响应示例

等待合并响应：
```json
{
  "status": "waiting",
  "cached_keys": ["sensor"]
}
```

成功入库响应：
```json
{
  "status": "success",
  "inserted": [
    "temperature_indoor",
    "humidity_indoor",
    "door_state"
  ]
}
```

---

#### 6. 响应参数说明

| 接口返回码 | 接口返回描述     |
|------------|------------------|
| 200        | 成功             |
| 400        | 缺少参数或格式异常 |
| 500        | 系统异常         |

#### 1. 接口说明
接口功能：  
手动插入一条完整的设备数据记录。

接口请求地址：
```
POST /data
```

---

#### 2. 请求头：

| 请求头       | 请求内容        | 说明     |
|--------------|-----------------|----------|
| Content-Type | application/json | JSON 格式 |

---

#### 3. 请求示例：

```json
{
  "temperature_indoor": 23.8,
  "humidity_indoor": 40,
  "door_state": "closed",
  "airConditioner_state": "on"
}
```

---

#### 4. 请求参数说明：

| 字段名               | 字段说明           | 字段类型     | 是否必填 |
|----------------------|--------------------|--------------|----------|
| temperature_indoor   | 室内温度           | decimal      | 是       |
| humidity_indoor      | 室内湿度           | decimal      | 是       |
| door_state           | 门开关状态         | string       | 否       |
| airConditioner_state | 空调运行状态       | string       | 否       |

---

#### 5. 响应示例

```json
{
  "status": "inserted",
  "fields": [
    "temperature_indoor",
    "humidity_indoor",
    "door_state",
    "airConditioner_state"
  ]
}
```

---

#### 6. 响应参数说明

| 接口返回码 | 接口返回描述 |
|------------|--------------|
| 201        | 插入成功     |
| 500        | 插入失败     |

#### 1. 接口说明
接口功能：  
查询全部设备数据，按时间倒序排列。

接口请求地址：
```
GET /data
```

---

#### 2. 请求头：

无需特殊请求头。

---

#### 3. 请求示例：

无需请求体。

---

#### 4. 请求参数说明：

无参数。

---

#### 5. 响应示例

```json
[
  {
    "device_data_id": 12,
    "temperature_indoor": 23.5,
    "humidity_indoor": 45,
    "created_at": "2024-04-07 10:33:25"
  },
  ...
]
```

---

#### 6. 响应参数说明

| 接口返回码 | 接口返回描述 |
|------------|--------------|
| 200        | 获取成功     |
| 500        | 查询失败     |

#### 1. 接口说明
接口功能：  
插入一条新的设备监测数据记录。

接口请求地址：
```
POST /data
```

---

#### 2. 请求头：

| 请求头       | 请求内容        | 说明         |
|--------------|-----------------|--------------|
| Content-Type | application/json | JSON 格式提交 |

---

#### 3. 请求示例：

```json
{
  "temperature_indoor": 24.5,
  "humidity_indoor": 55,
  "smoke": 0,
  "door_state": "open"
}
```

---

#### 4. 请求参数说明：

| 字段名             | 字段说明       | 字段类型 | 是否必填 |
|--------------------|----------------|----------|----------|
| temperature_indoor | 室内温度       | decimal  | 否       |
| humidity_indoor    | 室内湿度       | decimal  | 否       |
| smoke              | 烟雾传感器状态 | int      | 否       |
| door_state         | 门状态         | string   | 否       |

---

#### 5. 响应示例：

```json
{
  "status": "inserted",
  "fields": ["temperature_indoor", "humidity_indoor", "smoke", "door_state"]
}
```

---

#### 6. 响应参数说明：

| 接口返回码 | 接口返回描述 |
|------------|--------------|
| 201        | 插入成功     |
| 500        | 插入失败     |

#### 1. 接口说明
接口功能：  
获取所有设备数据记录，按时间倒序排列。

接口请求地址：
```
GET /data
```

---

#### 2. 请求头：

无需特殊头。

---

#### 3. 请求示例：

无请求体。

---

#### 4. 请求参数说明：

无。

---

#### 5. 响应示例：

```json
[
  {
    "device_data_id": 101,
    "temperature_indoor": 23.4,
    "created_at": "2025-04-07 12:10:00"
  },
  ...
]
```

---

#### 6. 响应参数说明：

| 接口返回码 | 接口返回描述 |
|------------|--------------|
| 200        | 获取成功     |
| 500        | 获取失败     |

#### 1. 接口说明
接口功能：  
根据主键 ID 查询某条数据记录。

接口请求地址：
```
GET /data/{id}
```

---

#### 2. 请求头：

无。

---

#### 3. 请求示例：

```
GET /data/5
```

---

#### 4. 请求参数说明：

| 参数名 | 说明       | 类型   | 是否必填 |
|--------|------------|--------|----------|
| id     | 数据记录 ID | int    | 是       |

---

#### 5. 响应示例：

```json
{
  "device_data_id": 5,
  "temperature_indoor": 22.0,
  "humidity_indoor": 60,
  "created_at": "2025-04-07 11:05:00"
}
```

---

#### 6. 响应参数说明：

| 接口返回码 | 接口返回描述 |
|------------|--------------|
| 200        | 获取成功     |
| 404        | 数据不存在   |
| 500        | 查询失败     |

#### 1. 接口说明
接口功能：  
根据 ID 更新某条设备数据记录。

接口请求地址：
```
PUT /data/{id}
```

---

#### 2. 请求头：

| 请求头       | 请求内容        | 说明         |
|--------------|-----------------|--------------|
| Content-Type | application/json | JSON 格式提交 |

---

#### 3. 请求示例：

```json
{
  "humidity_indoor": 42,
  "temperature_indoor": 26.8
}
```

---

#### 4. 请求参数说明：

| 字段名             | 字段说明       | 字段类型 | 是否必填 |
|--------------------|----------------|----------|----------|
| humidity_indoor    | 室内湿度       | decimal  | 否       |
| temperature_indoor | 室内温度       | decimal  | 否       |

---

#### 5. 响应示例：

```json
{
  "status": "updated",
  "id": 5
}
```

---

#### 6. 响应参数说明：

| 接口返回码 | 接口返回描述 |
|------------|--------------|
| 200        | 更新成功     |
| 500        | 更新失败     |

#### 1. 接口说明
接口功能：  
删除指定 ID 的设备数据记录。

接口请求地址：
```
DELETE /data/{id}
```

---

#### 2. 请求示例：

```
DELETE /data/5
```

---

#### 3. 请求参数说明：

| 参数名 | 说明       | 类型 | 是否必填 |
|--------|------------|------|----------|
| id     | 数据记录 ID | int  | 是       |

---

#### 4. 响应示例：

```json
{
  "status": "deleted",
  "id": 5
}
```

---

#### 5. 响应参数说明：

| 接口返回码 | 接口返回描述 |
|------------|--------------|
| 200        | 删除成功     |
| 500        | 删除失败     |

#### 1. 接口说明
接口功能：  
返回数据库中最新插入的一条设备数据。

接口请求地址：
```
GET /data/latest
```

---

#### 2. 请求示例：

无请求体。

---

#### 3. 响应示例：

```json
{
  "status": "success",
  "latest": {
    "device_data_id": 114,
    "temperature_indoor": 23.0,
    "humidity_indoor": 40,
    "created_at": "2025-04-07 14:55:32"
  }
}
```

---

#### 4. 响应参数说明：

| 接口返回码 | 接口返回描述 |
|------------|--------------|
| 200        | 成功         |
| 404        | 无数据       |
| 500        | 查询失败     |

#### 1. 接口说明
接口功能：  
导出最近 100 条设备数据为 CSV 文件下载。

接口请求地址：
```
GET /data/export
```

---

#### 2. 请求示例：

无请求体。

---

#### 3. 响应示例：

HTTP 200 OK，响应类型为 `text/csv`，触发浏览器文件下载。示例数据内容如下：

```
device_data_id,temperature_indoor,humidity_indoor,created_at
1,23.5,60,2025-04-07 12:01:00
2,22.8,58,2025-04-07 12:02:00
...
```

---

#### 4. 响应参数说明：

| 接口返回码 | 接口返回描述 |
|------------|--------------|
| 200        | 下载成功     |
| 404        | 无可导出数据 |
| 500        | 导出失败     |
